{% extends 'base.html' %}
{% block title %}Gratitude Jar - MindCare{% endblock %}

{% block content %}
<div class="gradient-bg py-8">
  <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
    <h1 class="text-4xl font-bold text-gray-800 mb-2">Gratitude Jar</h1>
    <p class="text-gray-600 mb-8">
      Collect your daily moments of gratitude and watch your jar fill with positivity
    </p>
  </div>
</div>

<div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
  <!-- Messages -->
  {% if messages %}
    {% for message in messages %}
      <div class="mb-4 p-4 rounded-lg {% if message.tags == 'success' %}bg-green-100 text-green-700{% elif message.tags == 'error' %}bg-red-100 text-red-700{% else %}bg-blue-100 text-blue-700{% endif %}">
        {{ message }}
      </div>
    {% endfor %}
  {% endif %}

  <div class="grid lg:grid-cols-2 gap-8">
    <!-- Gratitude Jar Visualization -->
    <div class="bg-white rounded-xl shadow-sm p-8 card-hover text-center">
      <h2 class="text-2xl font-semibold text-gray-800 mb-6">Your Gratitude Jar</h2>
      
      <!-- Jar Container -->
      <div class="relative mx-auto" style="width: 200px; height: 300px;">
        <!-- Jar Outline -->
        <div class="absolute inset-0 border-4 border-gray-400 rounded-b-full" style="border-top: 20px solid #8B5CF6; border-radius: 0 0 100px 100px;">
          <!-- Jar Lid -->
          <div class="absolute -top-6 left-1/2 transform -translate-x-1/2 w-24 h-4 bg-purple-500 rounded-full shadow-lg"></div>
          
          <!-- Gratitude Notes (Fill Level) -->
          <div id="jarFill" class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-yellow-200 via-orange-200 to-pink-200 transition-all duration-1000 ease-out" 
               style="height: {{ total_entries|floatformat:0 }}%; border-radius: 0 0 96px 96px; max-height: 100%;">
            <!-- Floating Notes Animation -->
            <div class="relative h-full overflow-hidden">
              {% for i in "12345"|make_list %}
                <div class="absolute animate-float-{{ forloop.counter }} opacity-70">
                  <div class="w-6 h-6 bg-white rounded-full shadow-sm flex items-center justify-center text-xs">üíù</div>
                </div>
              {% endfor %}
            </div>
          </div>
          
          <!-- Jar Label -->
          <div class="absolute bottom-4 left-1/2 transform -translate-x-1/2 bg-white px-3 py-1 rounded-full shadow-sm">
            <span class="text-sm font-semibold text-purple-600">{{ total_entries }} notes</span>
          </div>
        </div>
      </div>
      
      <div class="mt-6 text-center">
        <p class="text-gray-600 mb-2">Gratitude Level</p>
        <div class="w-full bg-gray-200 rounded-full h-3">
          <div class="bg-gradient-to-r from-purple-500 to-pink-500 h-3 rounded-full transition-all duration-1000" 
               style="width: {{ total_entries|add:0|floatformat:0 }}%; max-width: 100%;"></div>
        </div>
        <p class="text-sm text-gray-500 mt-2">{{ total_entries }} days of gratitude</p>
      </div>
    </div>

    <!-- Daily Entry Form -->
    <div class="bg-white rounded-xl shadow-sm p-8 card-hover">
      <h2 class="text-2xl font-semibold text-gray-800 mb-6">Today's Gratitude</h2>
      
      {% if can_add_today %}
        <form method="post" class="space-y-4">
          {% csrf_token %}
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">
              What are you grateful for today?
            </label>
            <textarea 
              name="gratitude_content" 
              rows="4" 
              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent resize-none"
              placeholder="I am grateful for..."
              maxlength="500"
              required></textarea>
            <p class="text-xs text-gray-500 mt-1">Maximum 500 characters</p>
          </div>
          <button type="submit" class="w-full bg-purple-500 text-white py-3 px-6 rounded-lg hover:bg-purple-600 transition card-hover">
            <i class="fas fa-heart mr-2"></i>Add to Jar
          </button>
        </form>
      {% else %}
        <div class="bg-green-50 border border-green-200 rounded-lg p-6 text-center">
          <i class="fas fa-check-circle text-green-500 text-3xl mb-3"></i>
          <h3 class="text-lg font-semibold text-green-800 mb-2">Today's Gratitude Added!</h3>
          <p class="text-green-700 mb-4">"{{ today_entry.content }}"</p>
          <p class="text-sm text-green-600">Come back tomorrow to add another note to your jar!</p>
        </div>
      {% endif %}
      
      <div class="mt-6 pt-6 border-t border-gray-200">
        <a href="{% url 'core:gratitude_history' %}" class="inline-flex items-center text-purple-600 hover:text-purple-700 transition">
          <i class="fas fa-history mr-2"></i>View All Entries
        </a>
      </div>
    </div>
  </div>

  <!-- Weekly Highlights -->
  {% if weekly_entries %}
  <div class="mt-8 bg-gradient-to-r from-purple-50 to-pink-50 rounded-xl p-8">
    <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">This Week's Gratitude Highlights</h2>
    <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
      {% for entry in weekly_entries %}
        <div class="bg-white rounded-lg p-4 shadow-sm card-hover">
          <div class="flex items-start justify-between mb-2">
            <span class="text-xs text-purple-600 font-semibold">{{ entry.date|date:"M d" }}</span>
            <i class="fas fa-heart text-pink-400"></i>
          </div>
          <p class="text-gray-700 text-sm">{{ entry.content|truncatechars:100 }}</p>
        </div>
      {% endfor %}
    </div>
  </div>
  {% endif %}

  <!-- Benefits Section -->
  <div class="mt-8 bg-gradient-to-r from-yellow-50 to-orange-50 rounded-xl p-8">
    <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">Benefits of Gratitude Practice</h2>
    <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6">
      <div class="text-center">
        <div class="bg-yellow-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
          <i class="fas fa-smile text-yellow-600 text-2xl"></i>
        </div>
        <h3 class="font-semibold text-gray-800 mb-2">Boosts Happiness</h3>
        <p class="text-gray-600 text-sm">Increases positive emotions and life satisfaction</p>
      </div>
      <div class="text-center">
        <div class="bg-green-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
          <i class="fas fa-heart text-green-600 text-2xl"></i>
        </div>
        <h3 class="font-semibold text-gray-800 mb-2">Reduces Stress</h3>
        <p class="text-gray-600 text-sm">Lowers cortisol levels and promotes relaxation</p>
      </div>
      <div class="text-center">
        <div class="bg-blue-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
          <i class="fas fa-users text-blue-600 text-2xl"></i>
        </div>
        <h3 class="font-semibold text-gray-800 mb-2">Better Relationships</h3>
        <p class="text-gray-600 text-sm">Strengthens social connections and empathy</p>
      </div>
      <div class="text-center">
        <div class="bg-purple-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
          <i class="fas fa-moon text-purple-600 text-2xl"></i>
        </div>
        <h3 class="font-semibold text-gray-800 mb-2">Better Sleep</h3>
        <p class="text-gray-600 text-sm">Improves sleep quality and duration</p>
      </div>
    </div>
  </div>
</div>

<style>
@keyframes float-1 {
  0%, 100% { transform: translate(20px, 80px) rotate(0deg); }
  50% { transform: translate(25px, 70px) rotate(180deg); }
}
@keyframes float-2 {
  0%, 100% { transform: translate(60px, 120px) rotate(0deg); }
  50% { transform: translate(55px, 110px) rotate(-180deg); }
}
@keyframes float-3 {
  0%, 100% { transform: translate(100px, 90px) rotate(0deg); }
  50% { transform: translate(105px, 80px) rotate(180deg); }
}
@keyframes float-4 {
  0%, 100% { transform: translate(140px, 130px) rotate(0deg); }
  50% { transform: translate(135px, 120px) rotate(-180deg); }
}
@keyframes float-5 {
  0%, 100% { transform: translate(80px, 60px) rotate(0deg); }
  50% { transform: translate(85px, 50px) rotate(180deg); }
}

.animate-float-1 { animation: float-1 4s ease-in-out infinite; }
.animate-float-2 { animation: float-2 5s ease-in-out infinite 1s; }
.animate-float-3 { animation: float-3 6s ease-in-out infinite 2s; }
.animate-float-4 { animation: float-4 4.5s ease-in-out infinite 0.5s; }
.animate-float-5 { animation: float-5 5.5s ease-in-out infinite 1.5s; }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const jarFill = document.getElementById('jarFill');
    const totalEntries = {{ total_entries }};
    
    // Animate jar filling on page load
    setTimeout(() => {
        const fillPercentage = Math.min((totalEntries * 3), 100); // 3% per entry, max 100%
        jarFill.style.height = fillPercentage + '%';
    }, 500);
    
    // Add sparkle effect when form is submitted
    const form = document.querySelector('form');
    if (form) {
        form.addEventListener('submit', function() {
            // Add visual feedback
            const button = form.querySelector('button[type="submit"]');
            button.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Adding to jar...';
            button.disabled = true;
        });
    }
});
</script>
{% endblock %}